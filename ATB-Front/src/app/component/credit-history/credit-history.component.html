<div class="container mt-5">
  <h2 class="text-center mb-4">Historique des demandes de crédit</h2>

  <!-- Filtre par statut -->
  <div class="text-center mb-4">
    <div class="btn-group" role="group" aria-label="Filtrer par statut">
      <button type="button" class="btn btn-outline-primary" (click)="filterByStatus('')">Tous</button>
      <button type="button" class="btn btn-outline-primary" (click)="filterByStatus('Submitted')">Soumis</button>
      <button type="button" class="btn btn-outline-primary" (click)="filterByStatus('In_Review')">En révision</button>
      <button type="button" class="btn btn-outline-primary" (click)="filterByStatus('Approved')">Approuvé</button>
      <button type="button" class="btn btn-outline-primary" (click)="filterByStatus('Rejected')">Rejeté</button>
    </div>
  </div>

  <div *ngIf="creditRequestsFiltered.length; else noData">
    <div class="row">
      <div class="col-md-12">
        <div class="list-group">
          <a *ngFor="let request of paginatedRequests" class="list-group-item list-group-item-action" data-toggle="modal" data-target="#creditRequestModal" (click)="modal(request)">
            <div class="d-flex w-100 justify-content-between">
              <h5 class="mb-1">Montant demandé : {{ request.requestedAmount }} DT</h5>
              <small class="status-badge {{ request.status | lowercase }}">{{ request.status }}</small>
            </div>
            <p class="mb-1">Terme : {{ request.term }} mois</p>
            <small class="text-muted">Date de création : {{ request.requestDate | date:'short' }}</small>
          </a>
        </div>
      </div>
    </div>

    <!-- Pagination -->
    <nav aria-label="Page navigation">
      <ul class="pagination justify-content-center">
        <li class="page-item" [class.disabled]="currentPage === 1">
          <a class="page-link" (click)="changePage(currentPage - 1)">Précédent</a>
        </li>
        <li class="page-item" *ngFor="let page of totalPagesArray" [class.active]="currentPage === page">
          <a class="page-link" (click)="changePage(page)">{{ page }}</a>
        </li>
        <li class="page-item" [class.disabled]="currentPage === totalPages">
          <a class="page-link" (click)="changePage(currentPage + 1)">Suivant</a>
        </li>
      </ul>
    </nav>
  </div>

  <ng-template #noData>
    <div class="alert alert-warning text-center">
      Aucune demande de crédit trouvée.
    </div>
  </ng-template>
</div>




  
  <!-- Modal -->
  <div class="modal fade custom-modal" id="creditRequestModal" tabindex="-1" role="dialog" aria-labelledby="creditRequestModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="creditRequestModalLabel">Détails de la demande de crédit</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <!-- Contenu du modal -->
          <h5>Montant demandé : </h5>
          <p>{{ selectedRequest?.requestedAmount }} DT</p>
          <h5>Terme : </h5>
          <p>{{ selectedRequest?.term }} mois</p>
          <h5>Date de création : </h5>
          <p>{{ selectedRequest?.requestDate | date:'short' }}</p>
          <div *ngIf="selectedCredit">
            <hr>
            <h5>Informations de crédit</h5>
            <p>Montant : {{ selectedCredit.ammount }}</p>
            <p>Date de début : {{ selectedCredit.startDate | date:'short' }}</p>
            <p>Date de fin : {{ selectedCredit.endDate | date:'short' }}</p>
            <p>Montant total à rembourser : {{ selectedCredit.totalAmountToRepay }}</p>
            <p>Solde restant : {{ selectedCredit.remainingBalance }}</p>
            <p>Statut : {{ selectedCredit.status }}</p>
           
          </div>
        </div>
        <div class="modal-footer">
          <ng-container *ngIf="selectedCredit && selectedCredit.status == 'Active'">
            <button class="btn btn-primary" data-toggle="modal" data-target="#paymentModal">Payer</button>
          </ng-container>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Fermer</button>
        
        </div>
      </div>
    </div>
  </div>
  


<!-- Modal de paiement -->
<div class="modal fade" id="paymentModal" tabindex="-1" role="dialog" aria-labelledby="paymentModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="paymentModalLabel">Effectuer un paiement</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="cardNumber">Numéro de carte</label>
          <input type="text" id="cardNumber" class="form-control" [(ngModel)]="cardNumber">
        </div>
        <div class="form-group">
          <label for="password">Mot de passe</label>
          <input type="password" id="password" class="form-control" [(ngModel)]="password">
        </div>
        <div class="form-group">
          <label for="amount">Montant à payer</label>
          <input type="number" id="amount" class="form-control" [(ngModel)]="paymentAmount" [value]="selectedCredit?.remainingBalance">
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Fermer</button>
        <button type="button" class="btn btn-primary" (click)="makePayment()">Payer</button>
      </div>
    </div>
  </div>
</div>
